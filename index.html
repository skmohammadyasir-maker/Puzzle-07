<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Puzzle Game ‚Äî Membership 007</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #0d0d0d;
        color: #fff;
        text-align: center;
        margin: 0;
        padding: 0;
    }
    #login-area, #game-area {
        margin-top: 20px;
    }
    #puzzle {
        width: 360px;
        margin: auto;
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 5px;
    }
    .piece {
        width: 85px;
        height: 85px;
        background-size: cover;
        border-radius: 8px;
        cursor: pointer;
        border: 2px solid #222;
    }
    #leaderboard {
        width: 90%;
        margin: 20px auto;
        padding: 10px;
        background: #111;
        border-radius: 10px;
    }
    button {
        background: #ff5722;
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        color: #fff;
        font-size: 16px;
        cursor: pointer;
    }
</style>
</head>

<body>

<h1>üß© Puzzle Game ‚Äî Membership 007</h1>

<!-- LOGIN AREA -->
<div id="login-area">
    <button id="googleLogin">Google ‡¶¶‡¶ø‡ßü‡ßá ‡¶≤‡¶ó‡¶á‡¶®</button>
</div>

<!-- GAME AREA -->
<div id="game-area" style="display:none;">
    <h2 id="userName"></h2>
    <h3>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ï‡ßã‡¶∞: <span id="score">0</span></h3>

    <div id="puzzle"></div>
</div>

<!-- LEADERBOARD -->
<div id="leaderboard">
    <h2>üèÜ Leaderboard</h2>
    <div id="boardList"></div>
</div>


<!-- Firebase Scripts -->
<script type="module">

/* ---------------------------
   üî• Firebase Configuration
---------------------------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBFbfVCHzWS9ZfsI_R7G5L95lIdsaAjqhM",
  authDomain: "membership-007.firebaseapp.com",
  databaseURL: "https://membership-007-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "membership-007",
  storageBucket: "membership-007.firebasestorage.app",
  messagingSenderId: "260769258496",
  appId: "1:260769258496:web:948c596e84f14c0c7f4ce5",
  measurementId: "G-PHW10NPS0B"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

/* ------------------------------
   üîê Google Login System
------------------------------- */
document.getElementById("googleLogin").onclick = function () {
    signInWithPopup(auth, provider)
        .then(result => {
            const user = result.user;
            document.getElementById("login-area").style.display = "none";
            document.getElementById("game-area").style.display = "block";
            document.getElementById("userName").innerText = "‡¶π‡ßç‡¶Ø‡¶æ‡¶≤‡ßã, " + user.displayName;
            loadGame();
        })
        .catch(error => {
            alert("Login Failed: " + error.message);
        });
};

/* ------------------------------
   üéÆ Puzzle Game Engine
------------------------------- */

const PIECES = [
    "https://res.cloudinary.com/dajuuabos/image/upload/v1763906618/1763905601546_1_s0wrla.png",
    "https://res.cloudinary.com/dajuuabos/image/upload/v1763906618/1763905601546_6_qbjlgx.png",
    "https://res.cloudinary.com/dajuuabos/image/upload/v1763906618/1763905601546_2_uivowl.png",
    "https://res.cloudinary.com/dajuuabos/image/upload/v1763906618/1763905601546_7_zimifj.png",
    "https://res.cloudinary.com/dajuuabos/image/upload/v1763906617/1763905601546_8_brkpjq.png",
    "https://res.cloudinary.com/dajuuabos/image/upload/v1763906617/1763905601546_3_ytc8om.png",
    "https://res.cloudinary.com/dajuuabos/image/upload/v1763906617/1763905601546_9_lhw92s.png",
    "https://res.cloudinary.com/dajuuabos/image/upload/v1763906617/1763905601546_10_ebby9p.png",
    "https://res.cloudinary.com/dajuuabos/image/upload/v1763906617/1763905601546_4_haza6x.png",
    "https://res.cloudinary.com/dajuuabos/image/upload/v1763906616/1763905601546_5_smvwh5.png",
    "https://res.cloudinary.com/dajuuabos/image/upload/v1763906616/1763905601546_11_zwzrvu.png",
    "https://res.cloudinary.com/dajuuabos/image/upload/v1763906616/1763905601546_12_jmlthv.png"
];

let score = 0;
let firstPick = null;

function loadGame() {
    const puzzle = document.getElementById("puzzle");
    puzzle.innerHTML = "";

    let shuffled = [...PIECES].sort(() => Math.random() - 0.5);

    shuffled.forEach((img, index) => {
        let div = document.createElement("div");
        div.className = "piece";
        div.style.backgroundImage = `url('${img}')`;
        div.dataset.index = index;

        div.onclick = () => selectPiece(div);

        puzzle.appendChild(div);
    });
}

function selectPiece(div) {
    if (!firstPick) {
        firstPick = div;
        div.style.border = "3px solid yellow";
    } else {
        // Swap pieces
        const temp = div.style.backgroundImage;
        div.style.backgroundImage = firstPick.style.backgroundImage;
        firstPick.style.backgroundImage = temp;

        firstPick.style.border = "2px solid #222";
        firstPick = null;

        score += 10;
        document.getElementById("score").innerText = score;

        saveScore();
    }
}

/* ------------------------------
   üíæ Save Score (Realtime DB)
------------------------------- */
function saveScore() {
    const user = auth.currentUser;
    if (!user) return;

    set(ref(db, "puzzleLeaderboard/" + user.uid), {
        name: user.displayName,
        score: score
    });
}

/* ------------------------------
   üèÜ Live Leaderboard
------------------------------- */
const leaderboardRef = ref(db, "puzzleLeaderboard");

onValue(leaderboardRef, snap => {
    const data = snap.val() || {};
    const sorted = Object.values(data).sort((a,b)=> b.score - a.score);

    let html = "";
    sorted.forEach((u,i)=>{
        html += `<p>${i+1}. ${u.name} ‚Äî ${u.score}</p>`;
    });

    document.getElementById("boardList").innerHTML = html;
});

</script>

</body>
</html>
